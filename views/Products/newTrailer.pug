include ../Components/Header
append styles
  style.
    .dropbtn {
      background-color: #04AA6D;
      color: white;
      padding: 16px;
      font-size: 16px;
      border: none;
      cursor: pointer;
    }
    .dropbtn:hover, .dropbtn:focus {
      background-color: #3e8e41;
    }
    #myInput {
      box-sizing: border-box;
      background-image: url('searchicon.png');
      background-position: 14px 12px;
      background-repeat: no-repeat;
      font-size: 16px;
      padding: 14px 20px 12px 45px;
      border: none;
      border-bottom: 1px solid #ddd;
    }
    #myInput:focus {outline: 3px solid #ddd;}
    .dropdown {
      position: relative;
      display: inline-block;
    }
    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f6f6f6;
      min-width: 230px;
      overflow: auto;
      border: 1px solid #ddd;
      z-index: 1;
    }
    .dropdown-content a {
      color: black;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
    }
    .dropdown a:hover {background-color: #ddd;}
    .show {display: block;}
block content
  br
  .container
    // Page Heading
    .d-sm-flex.align-items-left.justify-content-between.mb-4
      h1.h3.mb-0.text-gray-800=title
      .span
        a.d-none.d-sm-inline-block.btn.btn-sm.btn-success.shadow-sm.text-white.m-1(type='button' onclick="payNow()" )
          i.fas.fa-truck-moving.fa-sm.text-white-50
          |  زیاد کردنی بارهەڵگر
        a.d-none.d-sm-inline-block.btn.btn-sm.btn-danger.shadow-sm.text-white.m-1(type='button' href="/Products")
          i.fas.fa-times-circle.fa-sm.text-white-50
          |  گەڕانەوەی بارهەڵگر
        a.d-none.d-sm-inline-block.btn.btn-sm.btn-warning.shadow-sm.text-white.m-1(type='button' onclick='rearrangement()')
          i.fas.fa-reset.fa-sm.text-white-50
          |  ڕێکخستنەوەی بارهەڵگر
    .container(id="newRecord")
    .jumbotron
      .row
        .container-fluid.table-responsive
          table.table.table-striped
            thead.thead-dark
              .container(id="result")
            tbody
              .row
                .form-group.col-md-4
                  label ناوی کۆمپانیا
                  input(name="companyName" class="form-control fstdropdown-select" id="companyName" onclick='myFunction()' onkeyup='filterFunction()')
                  .dropdown
                    #myDropdown.dropdown-content
                      each item,i in company
                        a(href="#" onclick="getModel(this,event);" title=item['companyName'] type='button' data-toggle="modal" data-target="#confirm-product"+i)=item['companyName']
                .form-group.col-md-4
                  label نرخی تێچووی بارهەڵگر
                  input(type="text" name="PriceOfExpense" class="form-control fstdropdown-select" id="PriceOfExpense")
          .container(id="printableArea")
            .card.border.border-dark
              .card-header.justify-content-between
                .row
                  strong.col-md-10="ژمارەی تۆمار: "+invoiceID
                  span.col-md-2
                    strong بارهەڵگری نوێ
              .card-body
                //- .row.mb-4
                //-   .col-sm-6
                //-     h6.mb-3 بۆ:
                //-     div
                //-       strong="Titan Service - " + user.username
                //-     //- div Attn: Daniel Marek
                //-     div=Date().toLocaleString()
                //-     //- div Email: robert@daniel.com
                //-     div Phone: +964 750 000 00 00
                .table-responsive-sm
                  table.table.table-striped(id="invoiceTable")
                    thead
                      tr
                        th.center #
                        th ناوی بەرهەم
                        th ڕەنگ
                        th جۆری بەرهەم
                        th پێوانە
                        th وەکیل
                        th شرکە
                        th محل
                        th مفرد
                        th وەستا
                        th ژمارە
                        th نرخی کڕین
                        th نرخی کۆمپانیا
                        th.right کۆی گشتی
                    tbody(id="dataOfInvoiceTable")
                .row
                  .col-lg-8.col-sm-8
                    b تێبینی
                    textarea.form-control.rounded-0(rows='5' cols='80' id='note')
                  .col-lg-4.col-sm-4.ml-auto
                    table.table.table-clear(id="totalPayment")
                      tbody
                        tr
                          td.left
                            strong کۆی گشتی نرخ
                          td.right
                            strong(id="total") 0
      each item,i in company
        //- if element['manufacturerCompany']==item['companyName']
        .modal.fade(tabindex='-1' role='dialog' aria-labelledby='exampleModalCenterTitle' aria-hidden='true' id='confirm-product'+i)
          .modal-dialog.modal-dialog-centered.modal-xl(role='document')
            .modal-content
              .modal-header=item['companyName']
              thead.thead-dark
                .container(id="result")
              .modal-body(id='body-product'+i)
              .modal-footer
                button.btn.btn-default(type='button' data-dismiss='modal') گەڕانەوە
                a.btn.btn-success.btn-ok(onclick="resultOfValidation(this)" data-dismiss='modal') زیادکردنی بەرهەم
  script.
    // The code to open the dropdown 
    function myFunction() {
      document.getElementById("myDropdown").classList.toggle("show");
    }

    // Auto Find Datas in Input Form
    function filterFunction() {
      var input, filter, ul, li, a, i;
      input = document.getElementById("companyName");
      filter = input.value.toUpperCase();
      div = document.getElementById("myDropdown");
      a = div.getElementsByTagName("a");
      for (i = 0; i < a.length; i++) {
        txtValue = a[i].textContent || a[i].innerText;
        if (txtValue.toUpperCase().indexOf(filter) > -1) {
          a[i].style.display = "";
        } else {
          a[i].style.display = "none";
        }
      }
    }

    // Get Model Table
    function getModel(val, event) {
      var model=$(val).attr('data-target');
      var idOfModel= model.match(/\d+/)[0]
      event.preventDefault();
      var data=$.ajax({
        type: 'GET',
        url: "#{address}/Products/Model/Company/"+val.title,
        dataType: 'JSON',
        success: function(data){
          $('#body-product'+idOfModel).empty()
          $('#body-product'+idOfModel).append($("<table></table>").attr("id","datas"+idOfModel).attr('class',"table table-hover table-lg table-striped container-fluid table-responsive"));
          $('#datas'+idOfModel).append($("<tr></tr>").attr('style',"text-align:center").attr('id','header'+idOfModel));
          $('#header'+idOfModel).append($("<th></th>").text('#'));
          $('#header'+idOfModel).append($("<th></th>").text('ناوی بەرهەم'));
          $('#header'+idOfModel).append($("<th></th>").text('ڕەنگ'));
          $('#header'+idOfModel).append($("<th></th>").text('جۆری بەرهەم'));
          $('#header'+idOfModel).append($("<th></th>").text('پێوانە'));
          $('#header'+idOfModel).append($("<th></th>").text('وەکیل'));
          $('#header'+idOfModel).append($("<th></th>").text('شرکە'));
          $('#header'+idOfModel).append($("<th></th>").text('محل'));
          $('#header'+idOfModel).append($("<th></th>").text('مفرد'));
          $('#header'+idOfModel).append($("<th></th>").text('وەستا'));
          $('#header'+idOfModel).append($("<th></th>").text('ژمارە'));
          $('#header'+idOfModel).append($("<th></th>").text('نرخی کڕین'));
          //- 
          for (let i = 0; i < data.length; i++) {
            $('#datas'+idOfModel).append($("<tr></tr>").attr("id","rows"+idOfModel+i));
            $('#rows'+idOfModel+i).append($("<td></td>").attr('id','check'+idOfModel+i));
            $('#check'+idOfModel+i).append($("<input></input>").attr('id','checkstatus'+idOfModel+i).attr('type','checkbox').attr('value',data[i]['itemName']).attr('style','zoom: 1.5;'));
            $('#rows'+idOfModel+i).append($("<td></td>").text(data[i]['itemName']));
            $('#rows'+idOfModel+i).append($("<td></td>").text(data[i]['color']));
            $('#rows'+idOfModel+i).append($("<td></td>").text(data[i]['itemType']));
            $('#rows'+idOfModel+i).append($("<td></td>").text(data[i]['itemUnit']).attr('id',"unit"+idOfModel+i));
            $('#rows'+idOfModel+i).append($("<td></td>").text(data[i]['sellPriceWakil']));
            $('#rows'+idOfModel+i).append($("<td></td>").text(data[i]['sellPriceSharika']));
            $('#rows'+idOfModel+i).append($("<td></td>").text(data[i]['sellPriceMahal']));
            $('#rows'+idOfModel+i).append($("<td></td>").text(data[i]['sellPriceMufrad']));
            $('#rows'+idOfModel+i).append($("<td></td>").text(data[i]['sellPriceWasta']));
            $('#rows'+idOfModel+i).append($("<td></td>").attr('id','quantity'+idOfModel+i));
            $('#quantity'+idOfModel+i).append($("<input></input>").attr('style','zoom: 0.8;').attr('type','number').attr('name','totalQuan').attr('value','0').attr('class','form-control').attr('id','totalQuan'+idOfModel+i));
            $('#rows'+idOfModel+i).append($("<td></td>").attr('id','priceRow'+idOfModel+i));
            $('#priceRow'+idOfModel+i).append($("<input></input>").attr('style','zoom: 0.8;').attr('type','number').attr('name','priceOf').attr('id','priceOf'+idOfModel+i).attr('class','form-control').attr('value',"0"));
            }
          }
      })
    }

    //Section of Adding Selected items in Table
    function resultOfValidation(val){
      var table=val.parentNode.parentNode.childNodes[2].childNodes[0].childNodes;
      var checkstatus=val.parentNode.parentNode.childNodes[2].childNodes[0].childNodes[1].childNodes[0].firstChild.id;
      var expens=parseInt(document.getElementById('PriceOfExpense').value);
      var total=parseInt(document.getElementById('total').innerHTML);
      for (let i = 1; i < table.length; i++) {
        if(document.getElementById(table[i].childNodes[0].firstChild.id).checked==true){
          $("#invoiceTable").find('tbody')
            .append($('<tr>')
              .append($('<td>')
                .text($('#invoiceTable>tbody>tr').length+1)
              ).append($('<td>')
                .text(table[i].childNodes[0].firstChild.value) //Item Name
              ).append($('<td>')
                .text(table[i].childNodes[2].innerHTML) //Item Color
              ).append($('<td>')
                .text(table[i].childNodes[3].innerHTML) //
              ).append($('<td>')
                .text(table[i].childNodes[4].innerHTML)
              ).append($('<td>')
                .text(table[i].childNodes[5].innerHTML)
              ).append($('<td>')
                .text(table[i].childNodes[6].innerHTML)
              ).append($('<td>')
                .text(table[i].childNodes[7].innerHTML)
              ).append($('<td>')
                .text(table[i].childNodes[8].innerHTML)
              ).append($('<td>')
                .text(table[i].childNodes[9].innerHTML)
              ).append($('<td>')
                .text(table[i].childNodes[10].firstChild.value)
              ).append($('<td>')
                .text(table[i].childNodes[11].firstChild.value)
              ).append($("<td>")
                .text(" ")
              ).append($('<td>')
                .text(parseInt(table[i].childNodes[10].firstChild.value)*parseInt(table[i].childNodes[11].firstChild.value))
              )
            );
              document.getElementById('total').innerHTML=parseInt(document.getElementById('total').innerHTML)+parseInt(table[i].childNodes[10].firstChild.value)*parseInt(table[i].childNodes[11].firstChild.value)
        }
        else{
          continue;
        }
      }

      //- var subtotal=document.getElementById('subtotal').innerHTML;
      //- document.getElementById('subtotal').innerHTML=parseInt(subtotal)+document.getElementById("perPacket").value*document.getElementById("sellPrice").value
      //- document.getElementById('subtotal').innerHTML
    }

    function payNow(){
      objectData=document.getElementById("invoiceTable")

      //Send to Database
        var data= $.ajax({
          type: 'POST',
          url: "/Products/NewTrailer",
          dataType: 'JSON',
          data:getJSON(objectData),
          success: function(data){
            $('#newRecord').append($("<div></div>").attr("class","note note-success mt-2").text("باری نوێ بە سەرکەوتوویی زیاد کرا"));
          },
          error: function(err){
            $('#newRecord').append($("<div></div>").attr("class","note note-success mt-2").text("باری نوێ بە سەرکەوتوویی زیاد کرا"));
          }
      })
    }

    // Parse HTML table element to JSON array of objects
    function getJSON(table) {  
      // thead
      const thead = Array.from(table.tHead.rows[0].children).map((el) => el.textContent);

      // tbody
      const tbody = Array.from(table.tBodies[0].rows).map((row) =>
        Array.from(row.cells).map((cell) => cell.textContent)
      );

      return {
        tbody
      };
    }

    function printDiv(divName) {
      var printContents = document.getElementById(divName).innerHTML;
      var originalContents = document.body.innerHTML;

      document.body.innerHTML = printContents;

      window.print();

      document.body.innerHTML = originalContents;
    }

    function rearrangement(){
      var expense=parseInt(document.getElementById('PriceOfExpense').value); //Expense Price
      var total=parseInt(document.getElementById('total').innerHTML); //Total Price
      var objectData=document.getElementById("invoiceTable")
      if(isNaN(expense)){
        document.getElementById("PriceOfExpense").classList.add("btn-outline-danger")
        $('#newRecord').append($("<div></div>").attr("class","note note-danger mt-2").text("تکایە تێچووی بارهەڵگر پڕبکەوە"));
      }else{
        var table=objectData.tBodies[0].rows;
        for(var i=0;i<objectData.tBodies[0].rows.length;i++){
          console.log(table[i].cells[0].textContent)
          console.log(table[i].cells[1].textContent)
          console.log(table[i].cells[2].textContent)
          console.log(table[i].cells[3].textContent)
          console.log(table[i].cells[4].textContent)
          console.log(table[i].cells[5].textContent)
          console.log(table[i].cells[6].textContent)
          console.log(table[i].cells[7].textContent)
          console.log(table[i].cells[8].textContent)  //SellPriceMufrad
          console.log(table[i].cells[9].textContent)
          console.log(table[i].cells[10].textContent)
          console.log(table[i].cells[11].textContent) //Came Price
          console.log(table[i].cells[12].textContent=Math.round((expense/total)*parseInt(table[i].cells[8].textContent)+parseInt(table[i].cells[11].textContent))) //Company Price
          console.log(table[i].cells[13].textContent)

        }
      }
    }