include ../Components/Header
block content
  br
  .container-fluid
    // Page Heading
    .d-sm-flex.align-items-left.justify-content-between.mb-4
      h1.h3.mb-0.text-gray-800=title
      .span
        a.d-none.d-sm-inline-block.btn.btn-sm.btn-success.shadow-sm.text-white.mr-2(id="backup" href="/Profile/61f40f3142d5059afe5d42cd/NewRequest")
          i.fas.fa-database.fa-sm.text-white-50
          |  فرۆشتنی راستەوخۆ
        a.d-none.d-sm-inline-block.btn.btn-sm.btn-primary.shadow-sm.text-white.me-2(href="/Profiles/AddNew")
          i.fas.fa-plus-square.fa-sm.text-white-50
          |  زیادکردنی کڕیاری نوێ
    .container
      != messages('message', locals)
      if errors
        each error, i in errors
          div(class="note note-danger") #{error.msg}
    .row
      .container-fluid.table-responsive
        table(id="clientTable").table.table-hover.table-sm.dt-responsive.table-striped
          thead.thead-light
            tr(style="text-align:center; font-size:3 rem")
              th(scope='col') کردارەکان 
              th(scope='col') ناو
              th(scope='col') ژمارەی مۆبایل
              th(scope='col') ناوی کۆمپانیا
              th(scope='col') جۆری کڕیار
              th(scope='col') ئیمیڵ
              th(scope='col') ناونیشان
              th(scope='col') باڵانسی ماوە
              th(scope='col') ژمارەی فاتورە
              th(scope='col') کردارەکان 

          tbody
            each item,i in profiles
              - var json = JSON.stringify(profiles);
              - var j=i;
              - var time = new Date();
              tr(style="font-weight:bold; font-size:2 rem")
                form(method='POST')
                  td(style="text-align:center;")
                    //- a.btn.btn-sm.btn-secondary.mr-2( title="profiles Information" style="padding: .25rem .4rem;font-size: .875rem;line-height: .5;border-radius: .2rem;" type='button' data-toggle='modal' data-target='#infowindow'+i)
                    //-     span.icon.text-white-50
                    //-         i.fas.fa-info-circle
                    a.btn.btn-sm.btn-success.m-1(href="Profile/"+item['_id']+"/NewRequest" title="Add Invoice for "+item['clientName'])
                      span.icon.text-white-50
                        i.fas.fa-plus-square
                    //- a.disabled(target="_blank" title="Edit profiles" style="padding: .25rem .4rem;font-size: .875rem;line-height: .5;border-radius: .2rem;").btn.btn-sm.btn-warning.mr-2
                    //-     span.icon.text-white-50
                    //-         i.fas.fa-pencil-alt
                    //- a.btn.btn-sm.btn-danger.m-1(target="_blank" title="Delete Profiles" style="padding: .25rem .4rem;font-size: .875rem;line-height: .5;border-radius: .2rem;" data-toggle="modal" data-target="#confirm-delete"+i)
                    //-     span.icon.text-white-50
                    //-         i.fas.fa-trash-alt

                  td=item['clientName']
                  td(style="text-align:center;")=item['phoneNumber']
                  td(style="text-align:center;")=item['companyName']
                  td(style="text-align:center;")=item['clientType']
                  td(style="text-align:center;") "نیە"
                  td(style="text-align:center;") "نیە"
                  td(style="text-align:center;")=item['remainedbalance']
                  td(style="text-align:center;")=Object.keys(item['invoiceID']).length
                  td(style="text-align:center;")
                    a.btn.btn-sm.btn-info.m-1(title="profiles Invoices" href="/profiles/"+item['_id']+"/invoices")
                      span.icon.text-white-50
                        i.fas.fa-file-invoice
                    a.btn.btn-sm.btn-primary.m-1(href="/Products/"+item['_id']+"/NewRecover" title="گەڕانەوەی بەرهەم" style="padding: .25rem .4rem;font-size: .875rem;line-height: .5;border-radius: .2rem;")
                      span.icon.text-white-50
                        i.fas.fa-recycle
                    a.d-none.d-sm-inline-block.btn.btn-sm.btn-success.shadow-sm.text-white.m-1.disabled(type='button' data-toggle="modal" data-target="#confirm-payment")
                      span.icon.text-white-50
                        i.fas.fa-wallet.fa-sm.text-white-50
                    a.btn.btn-sm.btn-warning.m-1(title="نوەکردنەوەی زانیاریەکان" href="/Profiles/Modification/"+item['_id'])
                      span.icon.text-white-50
                        i.fas.fa-pencil-alt




                    // Modal
                    .modal.fade(tabindex='-1' role='dialog' aria-labelledby='exampleModalCenterTitle' aria-hidden='true' id=`confirm-delete${i}`)
                      .modal-dialog.modal-dialog-centered.modal-s(role='document')
                        .modal-content
                          .modal-header=item['clientName']

                          .modal-body ئایا دڵنیای لە ڕەشکردنەوەی  
                            b=item['clientName']
                          .modal-footer
                            button.btn.btn-default(type='button' data-dismiss='modal') گەڕانەوە
                            a.btn.btn-danger.btn-ok(id="objID"+i data-dismiss='modal' onclick='deleteRow(this,'+json+')') ڕەشکردنەوە
                    // Modal
                    .modal.fade(tabindex='-1' role='dialog' aria-labelledby='exampleModalCenterTitle' aria-hidden='true' id='confirm-payment')
                      .modal-dialog.modal-dialog-centered.modal-s(role='document')
                        .modal-content
                          .modal-header دواخستنی پارەدان
                          .modal-body 
                            p بڕی پارەی دراو
                              input.form-control(name="debut" type='number' step='any' value='0' id="paidmoney")
                          .modal-footer
                            button.btn.btn-default(type='button' data-dismiss='modal') گەڕانەوە
                            a.btn.btn-success.btn-ok(onclick="payNowDebut()" data-dismiss='modal') رازیبوون

  //- include ../Components/Footer
  script.
    $(document).ready(function() {
      $('#clientTable').DataTable({
        "pageLength": 10
      }
      );
    } );

    function deleteRow(r,GetArray) {
      var row = r.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.rowIndex;

        $.ajax({
          type: 'DELETE',
          url: "#{address}/Profiles/"+GetArray[row-1]['_id'],
          dataType: 'JSON'
          })
      document.getElementById("clientTable").deleteRow(row);
      }


